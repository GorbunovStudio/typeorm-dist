{"version":3,"sources":["../browser/src/driver/sqlite-abstract/AbstractSqliteQueryRunner.ts"],"names":[],"mappings":"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","file":"AbstractSqliteQueryRunner.js","sourcesContent":["import {QueryRunner} from \"../../query-runner/QueryRunner\";\r\nimport {ObjectLiteral} from \"../../common/ObjectLiteral\";\r\nimport {TransactionAlreadyStartedError} from \"../../error/TransactionAlreadyStartedError\";\r\nimport {TransactionNotStartedError} from \"../../error/TransactionNotStartedError\";\r\nimport {TableColumn} from \"../../schema-builder/schema/TableColumn\";\r\nimport {ColumnMetadata} from \"../../metadata/ColumnMetadata\";\r\nimport {Table} from \"../../schema-builder/schema/Table\";\r\nimport {TableIndex} from \"../../schema-builder/schema/TableIndex\";\r\nimport {TableForeignKey} from \"../../schema-builder/schema/TableForeignKey\";\r\nimport {TablePrimaryKey} from \"../../schema-builder/schema/TablePrimaryKey\";\r\nimport {RandomGenerator} from \"../../util/RandomGenerator\";\r\nimport {AbstractSqliteDriver} from \"./AbstractSqliteDriver\";\r\nimport {Connection} from \"../../connection/Connection\";\r\nimport {ReadStream} from \"../../platform/PlatformTools\";\r\nimport {EntityManager} from \"../../entity-manager/EntityManager\";\r\nimport {InsertResult} from \"../InsertResult\";\r\n\r\n/**\r\n * Runs queries on a single sqlite database connection.\r\n *\r\n * Does not support compose primary keys with autoincrement field.\r\n * todo: need to throw exception for this case.\r\n */\r\nexport class AbstractSqliteQueryRunner implements QueryRunner {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Implemented Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Database driver used by connection.\r\n     */\r\n    driver: AbstractSqliteDriver;\r\n\r\n    /**\r\n     * Connection used by this query runner.\r\n     */\r\n    connection: Connection;\r\n\r\n    /**\r\n     * Isolated entity manager working only with current query runner.\r\n     */\r\n    manager: EntityManager;\r\n\r\n    /**\r\n     * Indicates if connection for this query runner is released.\r\n     * Once its released, query runner cannot run queries anymore.\r\n     */\r\n    isReleased = false;\r\n\r\n    /**\r\n     * Indicates if transaction is in progress.\r\n     */\r\n    isTransactionActive = false;\r\n\r\n    /**\r\n     * Stores temporarily user data.\r\n     * Useful for sharing data with subscribers.\r\n     */\r\n    data = {};\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Indicates if special query runner mode in which sql queries won't be executed is enabled.\r\n     */\r\n    protected sqlMemoryMode: boolean = false;\r\n\r\n    /**\r\n     * Sql-s stored if \"sql in memory\" mode is enabled.\r\n     */\r\n    protected sqlsInMemory: string[] = [];\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Constructor\r\n    // -------------------------------------------------------------------------\r\n\r\n    constructor(driver: AbstractSqliteDriver) {}\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Creates/uses database connection from the connection pool to perform further operations.\r\n     * Returns obtained database connection.\r\n     */\r\n    connect(): Promise<any> {\r\n        return Promise.resolve(this.driver.databaseConnection);\r\n    }\r\n\r\n    /**\r\n     * Releases used database connection.\r\n     * We don't do anything here because sqlite do not support multiple connections thus query runners.\r\n     */\r\n    release(): Promise<void> {\r\n        return Promise.resolve();\r\n    }\r\n\r\n    /**\r\n     * Starts transaction.\r\n     */\r\n    async startTransaction(): Promise<void> {\r\n        if (this.isTransactionActive)\r\n            throw new TransactionAlreadyStartedError();\r\n\r\n        this.isTransactionActive = true;\r\n        await this.query(\"BEGIN TRANSACTION\");\r\n    }\r\n\r\n    /**\r\n     * Commits transaction.\r\n     * Error will be thrown if transaction was not started.\r\n     */\r\n    async commitTransaction(): Promise<void> {\r\n        if (!this.isTransactionActive)\r\n            throw new TransactionNotStartedError();\r\n\r\n        await this.query(\"COMMIT\");\r\n        this.isTransactionActive = false;\r\n    }\r\n\r\n    /**\r\n     * Rollbacks transaction.\r\n     * Error will be thrown if transaction was not started.\r\n     */\r\n    async rollbackTransaction(): Promise<void> {\r\n        if (!this.isTransactionActive)\r\n            throw new TransactionNotStartedError();\r\n\r\n        await this.query(\"ROLLBACK\");\r\n        this.isTransactionActive = false;\r\n    }\r\n\r\n    /**\r\n     * Executes a given SQL query.\r\n     */\r\n    query(query: string, parameters?: any[]): Promise<any> {\r\n        throw new Error(\"Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers\");\r\n    }\r\n\r\n    /**\r\n     * Returns raw data stream.\r\n     */\r\n    stream(query: string, parameters?: any[], onEnd?: Function, onError?: Function): Promise<ReadStream> {\r\n        throw new Error(`Stream is not supported by sqlite driver.`);\r\n    }\r\n\r\n    /**\r\n     * Insert a new row with given values into the given table.\r\n     * Returns value of the generated column if given and generate column exist in the table.\r\n     */\r\n    async insert(tableName: string, keyValues: ObjectLiteral): Promise<InsertResult> {\r\n        throw new Error(\"Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers\");\r\n    }\r\n\r\n    /**\r\n     * Updates rows that match given conditions in the given table.\r\n     */\r\n    async update(tableName: string, valuesMap: ObjectLiteral, conditions: ObjectLiteral): Promise<void> {\r\n        const updateValues = this.parametrize(valuesMap).join(\", \");\r\n        const conditionString = this.parametrize(conditions, Object.keys(valuesMap).length).join(\" AND \");\r\n        const query = `UPDATE \"${tableName}\" SET ${updateValues} ${conditionString ? (\" WHERE \" + conditionString) : \"\"}`;\r\n        const updateParams = Object.keys(valuesMap).map(key => valuesMap[key]);\r\n        const conditionParams = Object.keys(conditions).map(key => conditions[key]);\r\n        const allParameters = updateParams.concat(conditionParams);\r\n        await this.query(query, allParameters);\r\n    }\r\n\r\n    /**\r\n     * Deletes from the given table by a given conditions.\r\n     */\r\n    async delete(tableName: string, conditions: ObjectLiteral|string, maybeParameters?: any[]): Promise<void> {\r\n        const conditionString = typeof conditions === \"string\" ? conditions : this.parametrize(conditions).join(\" AND \");\r\n        const parameters = conditions instanceof Object ? Object.keys(conditions).map(key => (conditions as ObjectLiteral)[key]) : maybeParameters;\r\n\r\n        const sql = `DELETE FROM \"${tableName}\" WHERE ${conditionString}`;\r\n        await this.query(sql, parameters);\r\n    }\r\n\r\n    /**\r\n     * Inserts rows into closure table.\r\n     */\r\n    async insertIntoClosureTable(tableName: string, newEntityId: any, parentId: any, hasLevel: boolean): Promise<number> {\r\n        let sql = \"\";\r\n        if (hasLevel) {\r\n            sql = `INSERT INTO \"${tableName}\"(\"ancestor\", \"descendant\", \"level\") ` +\r\n                `SELECT \"ancestor\", ${newEntityId}, \"level\" + 1 FROM \"${tableName}\" WHERE \"descendant\" = ${parentId} ` +\r\n                `UNION ALL SELECT ${newEntityId}, ${newEntityId}, 1`;\r\n        } else {\r\n            sql = `INSERT INTO \"${tableName}\"(\"ancestor\", \"descendant\") ` +\r\n                `SELECT \"ancestor\", ${newEntityId} FROM \"${tableName}\" WHERE \"descendant\" = ${parentId} ` +\r\n                `UNION ALL SELECT ${newEntityId}, ${newEntityId}`;\r\n        }\r\n        await this.query(sql);\r\n        if (hasLevel) {\r\n            const results: ObjectLiteral[] = await this.query(`SELECT MAX(level) as level FROM ${tableName} WHERE descendant = ${parentId}`);\r\n            return results && results[0] && results[0][\"level\"] ? parseInt(results[0][\"level\"]) + 1 : 1;\r\n        } else {\r\n            return -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Loads given table's data from the database.\r\n     */\r\n    async getTable(tableName: string): Promise<Table|undefined> {\r\n        const tables = await this.getTables([tableName]);\r\n        return tables.length > 0 ? tables[0] : undefined;\r\n    }\r\n\r\n    /**\r\n     * Loads all tables (with given names) from the database and creates a Table from them.\r\n     */\r\n    async getTables(tableNames: string[]): Promise<Table[]> {\r\n        // if no tables given then no need to proceed\r\n        if (!tableNames || !tableNames.length)\r\n            return [];\r\n\r\n        const tableNamesString = tableNames.map(tableName => `'${tableName}'`).join(\", \");\r\n\r\n        // load tables, columns, indices and foreign keys\r\n        const dbTables: ObjectLiteral[] = await this.query(`SELECT * FROM sqlite_master WHERE type = 'table' AND name IN (${tableNamesString})`);\r\n\r\n        // if tables were not found in the db, no need to proceed\r\n        if (!dbTables || !dbTables.length)\r\n            return [];\r\n\r\n        // create table schemas for loaded tables\r\n        return Promise.all(dbTables.map(async dbTable => {\r\n            const table = new Table(dbTable[\"name\"]);\r\n\r\n            // load columns and indices\r\n            const [dbColumns, dbIndices, dbForeignKeys]: ObjectLiteral[][] = await Promise.all([\r\n                this.query(`PRAGMA table_info(\"${dbTable[\"name\"]}\")`),\r\n                this.query(`PRAGMA index_list(\"${dbTable[\"name\"]}\")`),\r\n                this.query(`PRAGMA foreign_key_list(\"${dbTable[\"name\"]}\")`),\r\n            ]);\r\n\r\n            // find column name with auto increment\r\n            let autoIncrementColumnName: string|undefined = undefined;\r\n            const tableSql: string = dbTable[\"sql\"];\r\n            if (tableSql.indexOf(\"AUTOINCREMENT\") !== -1) {\r\n                autoIncrementColumnName = tableSql.substr(0, tableSql.indexOf(\"AUTOINCREMENT\"));\r\n                const comma = autoIncrementColumnName.lastIndexOf(\",\");\r\n                const bracket = autoIncrementColumnName.lastIndexOf(\"(\");\r\n                if (comma !== -1) {\r\n                    autoIncrementColumnName = autoIncrementColumnName.substr(comma);\r\n                    autoIncrementColumnName = autoIncrementColumnName.substr(0, autoIncrementColumnName.lastIndexOf(\"\\\"\"));\r\n                    autoIncrementColumnName = autoIncrementColumnName.substr(autoIncrementColumnName.indexOf(\"\\\"\") + 1);\r\n\r\n                } else if (bracket !== -1) {\r\n                    autoIncrementColumnName = autoIncrementColumnName.substr(bracket);\r\n                    autoIncrementColumnName = autoIncrementColumnName.substr(0, autoIncrementColumnName.lastIndexOf(\"\\\"\"));\r\n                    autoIncrementColumnName = autoIncrementColumnName.substr(autoIncrementColumnName.indexOf(\"\\\"\") + 1);\r\n                }\r\n            }\r\n\r\n            // create columns from the loaded columns\r\n            table.columns = dbColumns.map(dbColumn => {\r\n                const tableColumn = new TableColumn();\r\n                tableColumn.name = dbColumn[\"name\"];\r\n                tableColumn.type = dbColumn[\"type\"].toLowerCase();\r\n                tableColumn.default = dbColumn[\"dflt_value\"] !== null && dbColumn[\"dflt_value\"] !== undefined ? dbColumn[\"dflt_value\"] : undefined;\r\n                tableColumn.isNullable = dbColumn[\"notnull\"] === 0;\r\n                // primary keys are numbered starting with 1, columns that aren't primary keys are marked with 0\r\n                tableColumn.isPrimary = dbColumn[\"pk\"] > 0;\r\n                tableColumn.comment = \"\"; // todo later\r\n                tableColumn.isGenerated = autoIncrementColumnName === dbColumn[\"name\"];\r\n                if (tableColumn.isGenerated) {\r\n                    tableColumn.generationStrategy = \"increment\";\r\n                }\r\n\r\n                // parse datatype and attempt to retrieve length\r\n                let pos = tableColumn.type.indexOf(\"(\");\r\n                if (pos !== -1) {\r\n                    let dataType = tableColumn.type.substr(0, pos);\r\n                    if (!!this.driver.withLengthColumnTypes.find(col => col === dataType)) {\r\n                        let len = parseInt(tableColumn.type.substring(pos + 1, tableColumn.type.length - 1));\r\n                        if (len) {\r\n                            tableColumn.length = len.toString();\r\n                            tableColumn.type = dataType; // remove the length part from the datatype\r\n                        }\r\n                    }\r\n                }\r\n                const columnForeignKeys = dbForeignKeys\r\n                    .filter(foreignKey => foreignKey[\"from\"] === dbColumn[\"name\"])\r\n                    .map(foreignKey => {\r\n                        // const keyName = this.driver.namingStrategy.foreignKeyName(dbTable[\"name\"], [foreignKey[\"from\"]], foreignKey[\"table\"], [foreignKey[\"to\"]]);\r\n                        // todo: figure out solution here, name should be same as naming strategy generates!\r\n                        const key = `${dbTable[\"name\"]}_${[foreignKey[\"from\"]].join(\"_\")}_${foreignKey[\"table\"]}_${[foreignKey[\"to\"]].join(\"_\")}`;\r\n                        const keyName = \"fk_\" + RandomGenerator.sha1(key).substr(0, 27);\r\n                        return new TableForeignKey(keyName, [foreignKey[\"from\"]], [foreignKey[\"to\"]], foreignKey[\"table\"], foreignKey[\"on_delete\"]); // todo: how sqlite return from and to when they are arrays? (multiple column foreign keys)\r\n                    });\r\n                table.addForeignKeys(columnForeignKeys);\r\n                return tableColumn;\r\n            });\r\n\r\n            // create primary key schema\r\n            await Promise.all(dbIndices\r\n                .filter(index => index[\"origin\"] === \"pk\")\r\n                .map(async index => {\r\n                    const indexInfos: ObjectLiteral[] = await this.query(`PRAGMA index_info(\"${index[\"name\"]}\")`);\r\n                    const indexColumns = indexInfos.map(indexInfo => indexInfo[\"name\"]);\r\n                    indexColumns.forEach(indexColumn => {\r\n                        table.primaryKeys.push(new TablePrimaryKey(index[\"name\"], indexColumn));\r\n                    });\r\n                }));\r\n\r\n            // create index schemas from the loaded indices\r\n            const indicesPromises = dbIndices\r\n                .filter(dbIndex => {\r\n                    return dbIndex[\"origin\"] !== \"pk\" &&\r\n                        (!table.foreignKeys.find(foreignKey => foreignKey.name === dbIndex[\"name\"])) &&\r\n                        (!table.primaryKeys.find(primaryKey => primaryKey.name === dbIndex[\"name\"]));\r\n                })\r\n                .map(dbIndex => dbIndex[\"name\"])\r\n                .filter((value, index, self) => self.indexOf(value) === index) // unqiue\r\n                .map(async dbIndexName => {\r\n                    const dbIndex = dbIndices.find(dbIndex => dbIndex[\"name\"] === dbIndexName);\r\n                    const indexInfos: ObjectLiteral[] = await this.query(`PRAGMA index_info(\"${dbIndex![\"name\"]}\")`);\r\n                    const indexColumns = indexInfos\r\n                        .sort((indexInfo1, indexInfo2) => parseInt(indexInfo1[\"seqno\"]) - parseInt(indexInfo2[\"seqno\"]))\r\n                        .map(indexInfo => indexInfo[\"name\"]);\r\n\r\n                    // check if db index is generated by sqlite itself and has special use case\r\n                    if (dbIndex![\"name\"].substr(0, \"sqlite_autoindex\".length) === \"sqlite_autoindex\") {\r\n                        if (dbIndex![\"unique\"] === 1) { // this means we have a special index generated for a column\r\n                            // so we find and update the column\r\n                            indexColumns.forEach(columnName => {\r\n                                const column = table.columns.find(column => column.name === columnName);\r\n                                if (column)\r\n                                    column.isUnique = true;\r\n                            });\r\n                        }\r\n\r\n                        return Promise.resolve(undefined);\r\n\r\n                    } else {\r\n                        const isUnique = dbIndex![\"unique\"] === \"1\" || dbIndex![\"unique\"] === 1;\r\n                        return new TableIndex(dbTable[\"name\"], dbIndex![\"name\"], indexColumns, isUnique);\r\n                    }\r\n                });\r\n\r\n            const indices = await Promise.all(indicesPromises);\r\n            table.indices = indices.filter(index => !!index) as TableIndex[];\r\n\r\n            return table;\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * Checks if database with the given name exist.\r\n     */\r\n    async hasDatabase(database: string): Promise<boolean> {\r\n        return Promise.resolve(false);\r\n    }\r\n\r\n    /**\r\n     * Checks if table with the given name exist in the database.\r\n     */\r\n    async hasTable(tableName: string): Promise<boolean> {\r\n        const sql = `SELECT * FROM sqlite_master WHERE type = 'table' AND name = '${tableName}'`;\r\n        const result = await this.query(sql);\r\n        return result.length ? true : false;\r\n    }\r\n\r\n    /**\r\n     * Creates a database if it's not created.\r\n     */\r\n    createDatabase(database: string): Promise<void[]> {\r\n        return Promise.resolve([]);\r\n    }\r\n\r\n    /**\r\n     * Creates a schema if it's not created.\r\n     */\r\n    createSchema(schemas: string[]): Promise<void[]> {\r\n        return Promise.resolve([]);\r\n    }\r\n\r\n    /**\r\n     * Creates a new table from the given table metadata and column metadatas.\r\n     */\r\n    async createTable(table: Table): Promise<void> {\r\n        // skip columns with foreign keys, we will add them later\r\n        const columnDefinitions = table.columns.map(column => this.buildCreateColumnSql(column)).join(\", \");\r\n        let sql = `CREATE TABLE \"${table.name}\" (${columnDefinitions}`;\r\n        const primaryKeyColumns = table.columns.filter(column => column.isPrimary && !column.isGenerated);\r\n        if (primaryKeyColumns.length > 0)\r\n            sql += `, PRIMARY KEY(${primaryKeyColumns.map(column => `${column.name}`).join(\", \")})`; // for some reason column escaping here generates a wrong schema\r\n        sql += `)`;\r\n        await this.query(sql);\r\n    }\r\n\r\n    /**\r\n     * Drops the table.\r\n     */\r\n    async dropTable(tableName: string): Promise<void> {\r\n        let sql = `DROP TABLE \"${tableName}\"`;\r\n        await this.query(sql);\r\n    }\r\n\r\n    /**\r\n     * Checks if column with the given name exist in the given table.\r\n     */\r\n    async hasColumn(tableName: string, columnName: string): Promise<boolean> {\r\n        const sql = `PRAGMA table_info(\"${tableName}\")`;\r\n        const columns: ObjectLiteral[] = await this.query(sql);\r\n        return !!columns.find(column => column[\"name\"] === columnName);\r\n    }\r\n\r\n    /**\r\n     * Creates a new column from the column in the table.\r\n     */\r\n    async addColumn(tableOrName: Table|string, column: TableColumn): Promise<void> {\r\n        const table = await this.getTableSchema(tableOrName);\r\n        const newTableSchema = table.clone();\r\n        newTableSchema.addColumns([column]);\r\n        await this.recreateTable(newTableSchema, table);\r\n    }\r\n\r\n    /**\r\n     * Creates a new columns from the column in the table.\r\n     */\r\n    async addColumns(tableOrName: Table|string, columns: TableColumn[]): Promise<void> {\r\n        const table = await this.getTableSchema(tableOrName);\r\n        const newTableSchema = table.clone();\r\n        newTableSchema.addColumns(columns);\r\n        await this.recreateTable(newTableSchema, table);\r\n    }\r\n\r\n    /**\r\n     * Renames column in the given table.\r\n     */\r\n    async renameColumn(tableOrName: Table|string, oldTableColumnOrName: TableColumn|string, newTableColumnOrName: TableColumn|string): Promise<void> {\r\n\r\n        let table: Table|undefined = undefined;\r\n        if (tableOrName instanceof Table) {\r\n            table = tableOrName;\r\n        } else {\r\n            table = await this.getTable(tableOrName);\r\n        }\r\n\r\n        if (!table)\r\n            throw new Error(`Table ${tableOrName} was not found.`);\r\n\r\n        let oldColumn: TableColumn|undefined = undefined;\r\n        if (oldTableColumnOrName instanceof TableColumn) {\r\n            oldColumn = oldTableColumnOrName;\r\n        } else {\r\n            oldColumn = table.columns.find(column => column.name === oldTableColumnOrName);\r\n        }\r\n\r\n        if (!oldColumn)\r\n            throw new Error(`Column \"${oldTableColumnOrName}\" was not found in the \"${tableOrName}\" table.`);\r\n\r\n        let newColumn: TableColumn|undefined = undefined;\r\n        if (newTableColumnOrName instanceof TableColumn) {\r\n            newColumn = newTableColumnOrName;\r\n        } else {\r\n            newColumn = oldColumn.clone();\r\n            newColumn.name = newTableColumnOrName;\r\n        }\r\n\r\n        return this.changeColumn(table, oldColumn, newColumn);\r\n    }\r\n\r\n    /**\r\n     * Changes a column in the table.\r\n     */\r\n    async changeColumn(tableOrName: Table|string, oldTableColumnOrName: TableColumn|string, newColumn: TableColumn): Promise<void> {\r\n        let table: Table|undefined = undefined;\r\n        if (tableOrName instanceof Table) {\r\n            table = tableOrName;\r\n        } else {\r\n            table = await this.getTable(tableOrName);\r\n        }\r\n\r\n        if (!table)\r\n            throw new Error(`Table ${tableOrName} was not found.`);\r\n\r\n        let oldColumn: TableColumn|undefined = undefined;\r\n        if (oldTableColumnOrName instanceof TableColumn) {\r\n            oldColumn = oldTableColumnOrName;\r\n        } else {\r\n            oldColumn = table.columns.find(column => column.name === oldTableColumnOrName);\r\n        }\r\n\r\n        if (!oldColumn)\r\n            throw new Error(`Column \"${oldTableColumnOrName}\" was not found in the \"${tableOrName}\" table.`);\r\n\r\n        // todo: fix it. it should not depend on table\r\n        return this.recreateTable(table);\r\n    }\r\n\r\n    /**\r\n     * Changes a column in the table.\r\n     * Changed column looses all its keys in the db.\r\n     */\r\n    async changeColumns(table: Table, changedColumns: { newColumn: TableColumn, oldColumn: TableColumn }[]): Promise<void> {\r\n        // todo: fix it. it should not depend on table\r\n        return this.recreateTable(table);\r\n    }\r\n\r\n    /**\r\n     * Drops column in the table.\r\n     */\r\n    async dropColumn(table: Table, column: TableColumn): Promise<void> {\r\n        return this.dropColumns(table, [column]);\r\n    }\r\n\r\n    /**\r\n     * Drops the columns in the table.\r\n     */\r\n    async dropColumns(table: Table, columns: TableColumn[]): Promise<void> {\r\n        const updatingTableSchema = table.clone();\r\n        updatingTableSchema.removeColumns(columns);\r\n        return this.recreateTable(updatingTableSchema);\r\n    }\r\n\r\n    /**\r\n     * Updates table's primary keys.\r\n     */\r\n    async updatePrimaryKeys(dbTable: Table): Promise<void> {\r\n        return this.recreateTable(dbTable);\r\n    }\r\n\r\n    /**\r\n     * Creates a new foreign key.\r\n     */\r\n    async createForeignKey(tableOrName: Table|string, foreignKey: TableForeignKey): Promise<void> {\r\n        return this.createForeignKeys(tableOrName as any, [foreignKey]);\r\n    }\r\n\r\n    /**\r\n     * Creates a new foreign keys.\r\n     */\r\n    async createForeignKeys(tableOrName: Table|string, foreignKeys: TableForeignKey[]): Promise<void> {\r\n        const table = await this.getTableSchema(tableOrName);\r\n        const changedTableSchema = table.clone();\r\n        changedTableSchema.addForeignKeys(foreignKeys);\r\n        return this.recreateTable(changedTableSchema);\r\n    }\r\n\r\n    /**\r\n     * Drops a foreign key from the table.\r\n     */\r\n    async dropForeignKey(tableOrName: Table|string, foreignKey: TableForeignKey): Promise<void> {\r\n        return this.dropForeignKeys(tableOrName as any, [foreignKey]);\r\n    }\r\n\r\n    /**\r\n     * Drops a foreign keys from the table.\r\n     */\r\n    async dropForeignKeys(tableOrName: Table|string, foreignKeys: TableForeignKey[]): Promise<void> {\r\n        const table = await this.getTableSchema(tableOrName);\r\n        const changedTableSchema = table.clone();\r\n        changedTableSchema.removeForeignKeys(foreignKeys);\r\n        return this.recreateTable(changedTableSchema);\r\n    }\r\n\r\n    /**\r\n     * Creates a new index.\r\n     */\r\n    async createIndex(table: Table|string, index: TableIndex): Promise<void> {\r\n        const columnNames = index.columnNames.map(columnName => `\"${columnName}\"`).join(\",\");\r\n        const sql = `CREATE ${index.isUnique ? \"UNIQUE \" : \"\"}INDEX \"${index.name}\" ON \"${table instanceof Table ? table.name : table}\"(${columnNames})`;\r\n        await this.query(sql);\r\n    }\r\n\r\n    /**\r\n     * Drops an index from the table.\r\n     */\r\n    async dropIndex(tableSchemeOrName: Table|string, indexName: string): Promise<void> {\r\n        const sql = `DROP INDEX \"${indexName}\"`;\r\n        await this.query(sql);\r\n    }\r\n\r\n    /**\r\n     * Truncates table.\r\n     */\r\n    async truncate(tableName: string): Promise<void> {\r\n        await this.query(`DELETE FROM \"${tableName}\"`);\r\n    }\r\n\r\n    /**\r\n     * Removes all tables from the currently connected database.\r\n     */\r\n    async clearDatabase(): Promise<void> {\r\n        await this.query(`PRAGMA foreign_keys = OFF;`);\r\n        await this.startTransaction();\r\n        try {\r\n            const selectDropsQuery = `select 'drop table \"' || name || '\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'`;\r\n            const dropQueries: ObjectLiteral[] = await this.query(selectDropsQuery);\r\n            await Promise.all(dropQueries.map(q => this.query(q[\"query\"])));\r\n            await this.commitTransaction();\r\n\r\n        } catch (error) {\r\n            try { // we throw original error even if rollback thrown an error\r\n                await this.rollbackTransaction();\r\n            } catch (rollbackError) { }\r\n            throw error;\r\n\r\n        } finally {\r\n            await this.query(`PRAGMA foreign_keys = ON;`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enables special query runner mode in which sql queries won't be executed,\r\n     * instead they will be memorized into a special variable inside query runner.\r\n     * You can get memorized sql using getMemorySql() method.\r\n     */\r\n    enableSqlMemory(): void {\r\n        this.sqlMemoryMode = true;\r\n    }\r\n\r\n    /**\r\n     * Disables special query runner mode in which sql queries won't be executed\r\n     * started by calling enableSqlMemory() method.\r\n     *\r\n     * Previously memorized sql will be flushed.\r\n     */\r\n    disableSqlMemory(): void {\r\n        this.sqlsInMemory = [];\r\n        this.sqlMemoryMode = false;\r\n    }\r\n\r\n    /**\r\n     * Gets sql stored in the memory. Parameters in the sql are already replaced.\r\n     */\r\n    getMemorySql(): (string|{ up: string, down: string })[] {\r\n        return this.sqlsInMemory;\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Parametrizes given object of values. Used to create column=value queries.\r\n     */\r\n    protected parametrize(objectLiteral: ObjectLiteral, startIndex: number = 0): string[] {\r\n        return Object.keys(objectLiteral).map((key, index) => `\"${key}\"` + \"=$\" + (startIndex + index + 1));\r\n    }\r\n\r\n    /**\r\n     * Builds a query for create column.\r\n     */\r\n    protected buildCreateColumnSql(column: TableColumn): string {\r\n        let c = \"\\\"\" + column.name + \"\\\"\";\r\n        if (column instanceof ColumnMetadata) {\r\n            c += \" \" + this.driver.normalizeType(column);\r\n        } else {\r\n            c += \" \" + this.connection.driver.createFullType(column);\r\n        }\r\n        if (column.collation)\r\n            c += \" COLLATE \" + column.collation;\r\n        if (column.isNullable !== true)\r\n            c += \" NOT NULL\";\r\n        if (column.isUnique === true)\r\n            c += \" UNIQUE\";\r\n        if (column.isGenerated === true && column.generationStrategy === \"increment\") { // don't use skipPrimary here since updates can update already exist primary without auto inc.\r\n            c += \" PRIMARY KEY AUTOINCREMENT\";\r\n        } else if (column.isPrimary === true && column.isGenerated === true) {\r\n            c += \" PRIMARY KEY\";\r\n        }\r\n\r\n        if (column.default !== undefined && column.default !== null) { // todo: same code in all drivers. make it DRY\r\n            c += \" DEFAULT (\" + column.default + \")\";\r\n        }\r\n\r\n        return c;\r\n    }\r\n\r\n    protected async recreateTable(table: Table, oldTableSchema?: Table, migrateData = true): Promise<void> {\r\n        // const withoutForeignKeyColumns = columns.filter(column => column.foreignKeys.length === 0);\r\n        // const createForeignKeys = options && options.createForeignKeys;\r\n        const columnDefinitions = table.columns.map(dbColumn => this.buildCreateColumnSql(dbColumn)).join(\", \");\r\n        const columnNames = table.columns.map(column => `\"${column.name}\"`).join(\", \");\r\n\r\n        let sql1 = `CREATE TABLE \"temporary_${table.name}\" (${columnDefinitions}`;\r\n        // if (options && options.createForeignKeys) {\r\n        table.foreignKeys.forEach(foreignKey => {\r\n            const columnNames = foreignKey.columnNames.map(name => `\"${name}\"`).join(\", \");\r\n            const referencedColumnNames = foreignKey.referencedColumnNames.map(name => `\"${name}\"`).join(\", \");\r\n            sql1 += `, FOREIGN KEY(${columnNames}) REFERENCES \"${foreignKey.referencedTableName}\"(${referencedColumnNames})`;\r\n            if (foreignKey.onDelete) sql1 += \" ON DELETE \" + foreignKey.onDelete;\r\n        });\r\n\r\n        const primaryKeyColumns = table.columns.filter(column => column.isPrimary && !column.isGenerated);\r\n        if (primaryKeyColumns.length > 0)\r\n            sql1 += `, PRIMARY KEY(${primaryKeyColumns.map(column => `${column.name}`).join(\", \")})`; // for some reason column escaping here generate a wrong schema\r\n\r\n        sql1 += \")\";\r\n\r\n        // todo: need also create uniques and indices?\r\n\r\n        // recreate a table with a temporary name\r\n        await this.query(sql1);\r\n\r\n        // we need only select data from old columns\r\n        const oldColumnNames = oldTableSchema ? oldTableSchema.columns.map(column => `\"${column.name}\"`).join(\", \") : columnNames;\r\n\r\n        // migrate all data from the table into temporary table\r\n        if (migrateData) {\r\n            const sql2 = `INSERT INTO \"temporary_${table.name}\"(${oldColumnNames}) SELECT ${oldColumnNames} FROM \"${table.name}\"`;\r\n            await this.query(sql2);\r\n        }\r\n\r\n        // drop old table\r\n        const sql3 = `DROP TABLE \"${table.name}\"`;\r\n        await this.query(sql3);\r\n\r\n        // rename temporary table\r\n        const sql4 = `ALTER TABLE \"temporary_${table.name}\" RENAME TO \"${table.name}\"`;\r\n        await this.query(sql4);\r\n\r\n        // also re-create indices\r\n        const indexPromises = table.indices.map(index => this.createIndex(table.name, index));\r\n        // const uniquePromises = table.uniqueKeys.map(key => this.createIndex(key));\r\n        await Promise.all(indexPromises/*.concat(uniquePromises)*/);\r\n    }\r\n\r\n    /**\r\n     * If given value is a table name then it loads its table schema representation from the database.\r\n     */\r\n    protected async getTableSchema(tableOrName: Table|string): Promise<Table> {\r\n        if (tableOrName instanceof Table) {\r\n            return tableOrName;\r\n        } else {\r\n            const table = await this.getTable(tableOrName);\r\n            if (!table)\r\n                throw new Error(`Table named ${tableOrName} was not found in the database.`);\r\n\r\n            return table;\r\n        }\r\n    }\r\n\r\n}\r\n"],"sourceRoot":"../.."}