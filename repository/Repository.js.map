{"version":3,"sources":["../../src/repository/Repository.ts"],"names":[],"mappings":"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","file":"Repository.js","sourcesContent":["import {EntityMetadata} from \"../metadata/EntityMetadata\";\r\nimport {FindManyOptions} from \"../find-options/FindManyOptions\";\r\nimport {ObjectLiteral} from \"../common/ObjectLiteral\";\r\nimport {FindOneOptions} from \"../find-options/FindOneOptions\";\r\nimport {DeepPartial} from \"../common/DeepPartial\";\r\nimport {SaveOptions} from \"./SaveOptions\";\r\nimport {RemoveOptions} from \"./RemoveOptions\";\r\nimport {EntityManager} from \"../entity-manager/EntityManager\";\r\nimport {QueryRunner} from \"../query-runner/QueryRunner\";\r\nimport {SelectQueryBuilder} from \"../query-builder/SelectQueryBuilder\";\r\n\r\n/**\r\n * Repository is supposed to work with your entity objects. Find entities, insert, update, delete, etc.\r\n */\r\nexport class Repository<Entity extends ObjectLiteral> {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Entity Manager used by this repository.\r\n     */\r\n    readonly manager: EntityManager;\r\n\r\n    /**\r\n     * Entity metadata of the entity current repository manages.\r\n     */\r\n    readonly metadata: EntityMetadata;\r\n\r\n    /**\r\n     * Query runner provider used for this repository.\r\n     */\r\n    readonly queryRunner?: QueryRunner;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Creates a new query builder that can be used to build a sql query.\r\n     */\r\n    createQueryBuilder(alias?: string, queryRunner?: QueryRunner): SelectQueryBuilder<Entity> {\r\n        return this.manager.createQueryBuilder(this.metadata.target, alias || this.metadata.targetName, queryRunner || this.queryRunner);\r\n    }\r\n\r\n    /**\r\n     * Returns object that is managed by this repository.\r\n     * If this repository manages entity from schema,\r\n     * then it returns a name of that schema instead.\r\n     */\r\n    get target(): Function|string {\r\n        return this.metadata.target;\r\n    }\r\n\r\n    /**\r\n     * Checks if entity has an id.\r\n     * If entity composite compose ids, it will check them all.\r\n     */\r\n    hasId(entity: Entity): boolean {\r\n        return this.manager.hasId(this.metadata.target, entity);\r\n    }\r\n\r\n    /**\r\n     * Gets entity mixed id.\r\n     */\r\n    getId(entity: Entity): any {\r\n        return this.manager.getId(this.metadata.target, entity);\r\n    }\r\n\r\n    /**\r\n     * Creates a new entity instance.\r\n     */\r\n    create(): Entity;\r\n\r\n    /**\r\n     * Creates a new entities and copies all entity properties from given objects into their new entities.\r\n     * Note that it copies only properties that present in entity schema.\r\n     */\r\n    create(entityLikeArray: DeepPartial<Entity>[]): Entity[];\r\n\r\n    /**\r\n     * Creates a new entity instance and copies all entity properties from this object into a new entity.\r\n     * Note that it copies only properties that present in entity schema.\r\n     */\r\n    create(entityLike: DeepPartial<Entity>): Entity;\r\n\r\n    /**\r\n     * Creates a new entity instance or instances.\r\n     * Can copy properties from the given object into new entities.\r\n     */\r\n    create(plainEntityLikeOrPlainEntityLikes?: DeepPartial<Entity>|DeepPartial<Entity>[]): Entity|Entity[] {\r\n        return this.manager.create<any>(this.metadata.target, plainEntityLikeOrPlainEntityLikes as any);\r\n    }\r\n\r\n    /**\r\n     * Merges multiple entities (or entity-like objects) into a given entity.\r\n     */\r\n    merge(mergeIntoEntity: Entity, ...entityLikes: DeepPartial<Entity>[]): Entity {\r\n        return this.manager.merge(this.metadata.target, mergeIntoEntity, ...entityLikes);\r\n    }\r\n\r\n    /**\r\n     * Creates a new entity from the given plan javascript object. If entity already exist in the database, then\r\n     * it loads it (and everything related to it), replaces all values with the new ones from the given object\r\n     * and returns this new entity. This new entity is actually a loaded from the db entity with all properties\r\n     * replaced from the new object.\r\n     *\r\n     * Note that given entity-like object must have an entity id / primary key to find entity by.\r\n     * Returns undefined if entity with given id was not found.\r\n     */\r\n    async preload(entityLike: DeepPartial<Entity>): Promise<Entity|undefined> {\r\n        return this.manager.preload(this.metadata.target, entityLike);\r\n    }\r\n\r\n    /**\r\n     * Saves all given entities in the database.\r\n     * If entities do not exist in the database then inserts, otherwise updates.\r\n     */\r\n    async save<T extends DeepPartial<Entity>>(entities: T[], options?: SaveOptions): Promise<T[]>;\r\n\r\n    /**\r\n     * Saves a given entity in the database.\r\n     * If entity does not exist in the database then inserts, otherwise updates.\r\n     */\r\n    async save<T extends DeepPartial<Entity>>(entity: T, options?: SaveOptions): Promise<T>;\r\n\r\n    /**\r\n     * Saves one or many given entities.\r\n     */\r\n    async save<T extends DeepPartial<Entity>>(entityOrEntities: T|T[], options?: SaveOptions): Promise<T|T[]> {\r\n        return this.manager.save(this.metadata.target, entityOrEntities as any, options);\r\n    }\r\n\r\n    /**\r\n     * Inserts a given entity into the database.\r\n     * Unlike save method executes a primitive operation without cascades, relations and other operations included.\r\n     * Does not modify source entity and does not execute listeners and subscribers.\r\n     * Executes fast and efficient INSERT query.\r\n     * Does not check if entity exist in the database, so query will fail if duplicate entity is being inserted.\r\n     */\r\n    async insert(entity: Partial<Entity>|Partial<Entity>[], options?: SaveOptions): Promise<void> {\r\n        return this.manager.insert(this.metadata.target, entity, options);\r\n    }\r\n\r\n    /**\r\n     * Updates entity partially. Entity can be found by a given conditions.\r\n     */\r\n    async update(conditions: Partial<Entity>, partialEntity: DeepPartial<Entity>, options?: SaveOptions): Promise<void> {\r\n        return this.manager.update(this.metadata.target, conditions, partialEntity, options);\r\n    }\r\n\r\n    /**\r\n     * Updates entity partially. Entity will be found by a given id.\r\n     */\r\n    async updateById(id: any, partialEntity: DeepPartial<Entity>, options?: SaveOptions): Promise<void> {\r\n        return this.manager.updateById(this.metadata.target, id, partialEntity, options);\r\n    }\r\n\r\n    /**\r\n     * Removes a given entities from the database.\r\n     */\r\n    async remove(entities: Entity[], options?: RemoveOptions): Promise<Entity[]>;\r\n\r\n    /**\r\n     * Removes a given entity from the database.\r\n     */\r\n    async remove(entity: Entity, options?: RemoveOptions): Promise<Entity>;\r\n\r\n    /**\r\n     * Removes one or many given entities.\r\n     */\r\n    async remove(entityOrEntities: Entity|Entity[], options?: RemoveOptions): Promise<Entity|Entity[]> {\r\n        return this.manager.remove(this.metadata.target, entityOrEntities as any, options);\r\n    }\r\n\r\n    /**\r\n     * Deletes entities by a given conditions.\r\n     * Unlike save method executes a primitive operation without cascades, relations and other operations included.\r\n     * Does not modify source entity and does not execute listeners and subscribers.\r\n     * Executes fast and efficient DELETE query.\r\n     * Does not check if entity exist in the database.\r\n     */\r\n    async delete(conditions: Partial<Entity>, options?: RemoveOptions): Promise<void> {\r\n        return this.manager.delete(this.metadata.target, conditions, options);\r\n    }\r\n\r\n    /**\r\n     * Deletes entities by a given conditions.\r\n     * Unlike save method executes a primitive operation without cascades, relations and other operations included.\r\n     * Does not modify source entity and does not execute listeners and subscribers.\r\n     * Executes fast and efficient DELETE query.\r\n     * Does not check if entity exist in the database.\r\n     */\r\n    async deleteById(id: any, options?: RemoveOptions): Promise<void> {\r\n        return this.manager.deleteById(this.metadata.target, id, options);\r\n    }\r\n\r\n    /**\r\n     * Removes entity by a given entity id.\r\n     *\r\n     * @deprecated use deleteById method instead.\r\n     */\r\n    async removeById(id: any, options?: RemoveOptions): Promise<void> {\r\n        return this.manager.deleteById(this.metadata.target, id, options);\r\n    }\r\n\r\n    /**\r\n     * Removes entity by a given entity id.\r\n     *\r\n     * @deprecated use deleteById method instead.\r\n     */\r\n    async removeByIds(ids: any[], options?: RemoveOptions): Promise<void> {\r\n        return this.manager.removeByIds(this.metadata.target, ids, options);\r\n    }\r\n\r\n    /**\r\n     * Counts entities that match given options.\r\n     */\r\n    count(options?: FindManyOptions<Entity>): Promise<number>;\r\n\r\n    /**\r\n     * Counts entities that match given conditions.\r\n     */\r\n    count(conditions?: DeepPartial<Entity>): Promise<number>;\r\n\r\n    /**\r\n     * Counts entities that match given find options or conditions.\r\n     */\r\n    count(optionsOrConditions?: FindManyOptions<Entity>|DeepPartial<Entity>): Promise<number> {\r\n        return this.manager.count(this.metadata.target, optionsOrConditions as any);\r\n    }\r\n\r\n    /**\r\n     * Finds entities that match given options.\r\n     */\r\n    find(options?: FindManyOptions<Entity>): Promise<Entity[]>;\r\n\r\n    /**\r\n     * Finds entities that match given conditions.\r\n     */\r\n    find(conditions?: DeepPartial<Entity>): Promise<Entity[]>;\r\n\r\n    /**\r\n     * Finds entities that match given find options or conditions.\r\n     */\r\n    find(optionsOrConditions?: FindManyOptions<Entity>|DeepPartial<Entity>): Promise<Entity[]> {\r\n        return this.manager.find(this.metadata.target, optionsOrConditions as any);\r\n    }\r\n\r\n    /**\r\n     * Finds entities that match given find options.\r\n     * Also counts all entities that match given conditions,\r\n     * but ignores pagination settings (from and take options).\r\n     */\r\n    findAndCount(options?: FindManyOptions<Entity>): Promise<[ Entity[], number ]>;\r\n\r\n    /**\r\n     * Finds entities that match given conditions.\r\n     * Also counts all entities that match given conditions,\r\n     * but ignores pagination settings (from and take options).\r\n     */\r\n    findAndCount(conditions?: DeepPartial<Entity>): Promise<[ Entity[], number ]>;\r\n\r\n    /**\r\n     * Finds entities that match given find options or conditions.\r\n     * Also counts all entities that match given conditions,\r\n     * but ignores pagination settings (from and take options).\r\n     */\r\n    findAndCount(optionsOrConditions?: FindManyOptions<Entity>|DeepPartial<Entity>): Promise<[ Entity[], number ]> {\r\n        return this.manager.findAndCount(this.metadata.target, optionsOrConditions as any);\r\n    }\r\n\r\n    /**\r\n     * Finds entities by ids.\r\n     * Optionally find options can be applied.\r\n     */\r\n    findByIds(ids: any[], options?: FindManyOptions<Entity>): Promise<Entity[]>;\r\n\r\n    /**\r\n     * Finds entities by ids.\r\n     * Optionally conditions can be applied.\r\n     */\r\n    findByIds(ids: any[], conditions?: DeepPartial<Entity>): Promise<Entity[]>;\r\n\r\n    /**\r\n     * Finds entities by ids.\r\n     * Optionally find options can be applied.\r\n     */\r\n    findByIds(ids: any[], optionsOrConditions?: FindManyOptions<Entity>|DeepPartial<Entity>): Promise<Entity[]> {\r\n        return this.manager.findByIds(this.metadata.target, ids, optionsOrConditions as any);\r\n    }\r\n\r\n    /**\r\n     * Finds first entity that matches given options.\r\n     */\r\n    findOne(options?: FindOneOptions<Entity>): Promise<Entity|undefined>;\r\n\r\n    /**\r\n     * Finds first entity that matches given conditions.\r\n     */\r\n    findOne(conditions?: DeepPartial<Entity>): Promise<Entity|undefined>;\r\n\r\n    /**\r\n     * Finds first entity that matches given conditions.\r\n     */\r\n    findOne(optionsOrConditions?: FindOneOptions<Entity>|DeepPartial<Entity>): Promise<Entity|undefined> {\r\n        return this.manager.findOne(this.metadata.target, optionsOrConditions as any);\r\n    }\r\n\r\n    /**\r\n     * Finds entity by given id.\r\n     * Optionally find options can be applied.\r\n     */\r\n    findOneById(id: any, options?: FindOneOptions<Entity>): Promise<Entity|undefined>;\r\n\r\n    /**\r\n     * Finds entity by given id.\r\n     * Optionally conditions can be applied.\r\n     */\r\n    findOneById(id: any, conditions?: DeepPartial<Entity>): Promise<Entity|undefined>;\r\n\r\n    /**\r\n     * Finds entity by given id.\r\n     * Optionally find options or conditions can be applied.\r\n     */\r\n    findOneById(id: any, optionsOrConditions?: FindOneOptions<Entity>|DeepPartial<Entity>): Promise<Entity|undefined> {\r\n        return this.manager.findOneById(this.metadata.target, id, optionsOrConditions as any);\r\n    }\r\n\r\n    /**\r\n     * Executes a raw SQL query and returns a raw database results.\r\n     * Raw query execution is supported only by relational databases (MongoDB is not supported).\r\n     */\r\n    async query(query: string, parameters?: any[]): Promise<any> {\r\n        return this.manager.query(query, parameters);\r\n    }\r\n\r\n    /**\r\n     * Clears all the data from the given table/collection (truncates/drops it).\r\n     *\r\n     * Note: this method uses TRUNCATE and may not work as you expect in transactions on some platforms.\r\n     * @see https://stackoverflow.com/a/5972738/925151\r\n     */\r\n    async clear(): Promise<void> {\r\n        return this.manager.clear(this.metadata.target);\r\n    }\r\n\r\n}"],"sourceRoot":".."}