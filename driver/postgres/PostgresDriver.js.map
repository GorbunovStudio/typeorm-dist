{"version":3,"sources":["../../src/driver/postgres/PostgresDriver.ts"],"names":[],"mappings":"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","file":"PostgresDriver.js","sourcesContent":["import {Driver} from \"../Driver\";\r\nimport {ConnectionIsNotSetError} from \"../../error/ConnectionIsNotSetError\";\r\nimport {ObjectLiteral} from \"../../common/ObjectLiteral\";\r\nimport {DriverPackageNotInstalledError} from \"../../error/DriverPackageNotInstalledError\";\r\nimport {DriverUtils} from \"../DriverUtils\";\r\nimport {ColumnMetadata} from \"../../metadata/ColumnMetadata\";\r\nimport {PostgresQueryRunner} from \"./PostgresQueryRunner\";\r\nimport {DateUtils} from \"../../util/DateUtils\";\r\nimport {PlatformTools} from \"../../platform/PlatformTools\";\r\nimport {Connection} from \"../../connection/Connection\";\r\nimport {RdbmsSchemaBuilder} from \"../../schema-builder/RdbmsSchemaBuilder\";\r\nimport {PostgresConnectionOptions} from \"./PostgresConnectionOptions\";\r\nimport {MappedColumnTypes} from \"../types/MappedColumnTypes\";\r\nimport {ColumnType} from \"../types/ColumnTypes\";\r\nimport {QueryRunner} from \"../../query-runner/QueryRunner\";\r\nimport {DataTypeDefaults} from \"../types/DataTypeDefaults\";\r\nimport {TableColumn} from \"../../schema-builder/schema/TableColumn\";\r\nimport {PostgresConnectionCredentialsOptions} from \"./PostgresConnectionCredentialsOptions\";\r\n\r\n/**\r\n * Organizes communication with PostgreSQL DBMS.\r\n */\r\nexport class PostgresDriver implements Driver {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Connection used by driver.\r\n     */\r\n    connection: Connection;\r\n\r\n    /**\r\n     * Postgres underlying library.\r\n     */\r\n    postgres: any;\r\n\r\n    /**\r\n     * Pool for master database.\r\n     */\r\n    master: any;\r\n\r\n    /**\r\n     * Pool for slave databases.\r\n     * Used in replication.\r\n     */\r\n    slaves: any[] = [];\r\n\r\n    /**\r\n     * We store all created query runners because we need to release them.\r\n     */\r\n    connectedQueryRunners: QueryRunner[] = [];\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Implemented Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Connection options.\r\n     */\r\n    options: PostgresConnectionOptions;\r\n\r\n    /**\r\n     * Master database used to perform all write queries.\r\n     */\r\n    database?: string;\r\n\r\n    /**\r\n     * Indicates if replication is enabled.\r\n     */\r\n    isReplicated: boolean = false;\r\n\r\n    /**\r\n     * Indicates if tree tables are supported by this driver.\r\n     */\r\n    treeSupport = true;\r\n\r\n    /**\r\n     * Gets list of supported column data types by a driver.\r\n     *\r\n     * @see https://www.tutorialspoint.com/postgresql/postgresql_data_types.htm\r\n     * @see https://www.postgresql.org/docs/9.2/static/datatype.html\r\n     */\r\n    supportedDataTypes: ColumnType[] = [\r\n        \"smallint\",\r\n        \"integer\",\r\n        \"bigint\",\r\n        \"decimal\",\r\n        \"numeric\",\r\n        \"real\",\r\n        \"double precision\",\r\n        \"money\",\r\n        \"character varying\",\r\n        \"varchar\",\r\n        \"character\",\r\n        \"char\",\r\n        \"text\",\r\n        \"citext\",\r\n        \"bytea\",\r\n        \"bit\",\r\n        \"bit varying\",\r\n        \"timestamp\",\r\n        \"timestamp without time zone\",\r\n        \"timestamp with time zone\",\r\n        \"date\",\r\n        \"time\",\r\n        \"time without time zone\",\r\n        \"time with time zone\",\r\n        \"interval\",\r\n        \"boolean\",\r\n        \"enum\",\r\n        \"point\",\r\n        \"line\",\r\n        \"lseg\",\r\n        \"box\",\r\n        \"path\",\r\n        \"polygon\",\r\n        \"circle\",\r\n        \"cidr\",\r\n        \"inet\",\r\n        \"macaddr\",\r\n        \"tsvector\",\r\n        \"tsquery\",\r\n        \"uuid\",\r\n        \"xml\",\r\n        \"json\",\r\n        \"jsonb\"\r\n    ];\r\n\r\n    /**\r\n     * Gets list of column data types that support length by a driver.\r\n     */\r\n    withLengthColumnTypes: ColumnType[] = [\r\n        \"character varying\",\r\n        \"varchar\",\r\n        \"character\",\r\n        \"char\",\r\n        \"bit\",\r\n        \"bit varying\"\r\n    ];\r\n\r\n    /**\r\n     * Orm has special columns and we need to know what database column types should be for those types.\r\n     * Column types are driver dependant.\r\n     */\r\n    mappedDataTypes: MappedColumnTypes = {\r\n        createDate: \"timestamp\",\r\n        createDateDefault: \"now()\",\r\n        updateDate: \"timestamp\",\r\n        updateDateDefault: \"now()\",\r\n        version: \"int\",\r\n        treeLevel: \"int\",\r\n        migrationName: \"varchar\",\r\n        migrationTimestamp: \"bigint\",\r\n        cacheId: \"int\",\r\n        cacheIdentifier: \"varchar\",\r\n        cacheTime: \"bigint\",\r\n        cacheDuration: \"int\",\r\n        cacheQuery: \"text\",\r\n        cacheResult: \"text\",\r\n    };\r\n\r\n    /**\r\n     * Default values of length, precision and scale depends on column data type.\r\n     * Used in the cases when length/precision/scale is not specified by user.\r\n     */\r\n    dataTypeDefaults: DataTypeDefaults;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Constructor\r\n    // -------------------------------------------------------------------------\r\n\r\n    constructor(connection: Connection) {\r\n        this.connection = connection;\r\n        this.options = connection.options as PostgresConnectionOptions;\r\n        this.isReplicated = this.options.replication ? true : false;\r\n\r\n        // load postgres package\r\n        this.loadDependencies();\r\n\r\n        // Object.assign(this.options, DriverUtils.buildDriverOptions(connection.options)); // todo: do it better way\r\n        // validate options to make sure everything is set\r\n        // todo: revisit validation with replication in mind\r\n        // if (!this.options.host)\r\n        //     throw new DriverOptionNotSetError(\"host\");\r\n        // if (!this.options.username)\r\n        //     throw new DriverOptionNotSetError(\"username\");\r\n        // if (!this.options.database)\r\n        //     throw new DriverOptionNotSetError(\"database\");\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Implemented Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Performs connection to the database.\r\n     * Based on pooling options, it can either create connection immediately,\r\n     * either create a pool and create connection when needed.\r\n     */\r\n    async connect(): Promise<void> {\r\n\r\n        if (this.options.replication) {\r\n            this.slaves = await Promise.all(this.options.replication.slaves.map(slave => {\r\n                return this.createPool(this.options, slave);\r\n            }));\r\n            this.master = await this.createPool(this.options, this.options.replication.master);\r\n            this.database = this.options.replication.master.database;\r\n\r\n        } else {\r\n            this.master = await this.createPool(this.options, this.options);\r\n            this.database = this.options.database;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Makes any action after connection (e.g. create extensions in Postgres driver).\r\n     */\r\n    async afterConnect(): Promise<void> {\r\n        const hasUuidColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.generatedColumns.filter(column => column.generationStrategy === \"uuid\").length > 0;\r\n        });\r\n        const hasCitextColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.columns.filter(column => column.type === \"citext\").length > 0;\r\n        });\r\n\r\n        if (hasUuidColumns || hasCitextColumns) {\r\n            await Promise.all([this.master, ...this.slaves].map(pool => {\r\n                return new Promise((ok, fail) => {\r\n                    pool.connect(async (err: any, connection: any, release: Function) => {\r\n                        const { logger } = this.connection;\r\n                        if (err) return fail(err);\r\n                        if (hasUuidColumns)\r\n                            try {\r\n                                await this.executeQuery(connection, `CREATE extension IF NOT EXISTS \"uuid-ossp\"`);\r\n                            } catch (_) {\r\n                                logger.log(\"warn\", \"At least one of the entities has uuid column, but the 'uuid-ossp' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n                            }\r\n                        if (hasCitextColumns)\r\n                            try {\r\n                                await this.executeQuery(connection, `CREATE extension IF NOT EXISTS \"citext\"`);\r\n                            } catch (_) {\r\n                                logger.log(\"warn\", \"At least one of the entities has citext column, but the 'citext' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n                            }\r\n                        release();\r\n                        ok();\r\n                    });\r\n                });\r\n            }));\r\n        }\r\n\r\n        return Promise.resolve();\r\n    }\r\n\r\n    /**\r\n     * Closes connection with database.\r\n     */\r\n    async disconnect(): Promise<void> {\r\n        if (!this.master)\r\n            return Promise.reject(new ConnectionIsNotSetError(\"postgres\"));\r\n\r\n        await this.closePool(this.master);\r\n        await Promise.all(this.slaves.map(slave => this.closePool(slave)));\r\n        this.master = undefined;\r\n        this.slaves = [];\r\n    }\r\n\r\n    /**\r\n     * Creates a schema builder used to build and sync a schema.\r\n     */\r\n    createSchemaBuilder() {\r\n        return new RdbmsSchemaBuilder(this.connection);\r\n    }\r\n\r\n    /**\r\n     * Creates a query runner used to execute database queries.\r\n     */\r\n    createQueryRunner(mode: \"master\"|\"slave\" = \"master\") {\r\n        return new PostgresQueryRunner(this, mode);\r\n    }\r\n\r\n    /**\r\n     * Prepares given value to a value to be persisted, based on its column type and metadata.\r\n     */\r\n    preparePersistentValue(value: any, columnMetadata: ColumnMetadata): any {\r\n        if (columnMetadata.transformer)\r\n            value = columnMetadata.transformer.to(value);\r\n\r\n        if (value === null || value === undefined)\r\n            return value;\r\n\r\n        if (columnMetadata.type === Boolean) {\r\n            return value === true ? 1 : 0;\r\n\r\n        } else if (columnMetadata.type === \"date\") {\r\n            return DateUtils.mixedDateToDateString(value);\r\n\r\n        } else if (columnMetadata.type === \"time\") {\r\n            return DateUtils.mixedDateToTimeString(value);\r\n\r\n        } else if (columnMetadata.type === \"datetime\"\r\n            || columnMetadata.type === Date\r\n            || columnMetadata.type === \"timestamp\"\r\n            || columnMetadata.type === \"timestamp with time zone\"\r\n            || columnMetadata.type === \"timestamp without time zone\") {\r\n            return DateUtils.mixedDateToDate(value);\r\n\r\n        } else if (columnMetadata.type === \"json\" || columnMetadata.type === \"jsonb\") {\r\n            return JSON.stringify(value);\r\n\r\n        } else if (columnMetadata.type === \"simple-array\") {\r\n            return DateUtils.simpleArrayToString(value);\r\n\r\n        } else if (columnMetadata.type === \"simple-json\") {\r\n            return DateUtils.simpleJsonToString(value);\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Prepares given value to a value to be persisted, based on its column type or metadata.\r\n     */\r\n    prepareHydratedValue(value: any, columnMetadata: ColumnMetadata): any {\r\n        if (value === null || value === undefined)\r\n            return value;\r\n\r\n        if (columnMetadata.type === Boolean) {\r\n            value = value ? true : false;\r\n\r\n        } else if (columnMetadata.type === \"datetime\"\r\n            || columnMetadata.type === Date\r\n            || columnMetadata.type === \"timestamp\"\r\n            || columnMetadata.type === \"timestamp with time zone\"\r\n            || columnMetadata.type === \"timestamp without time zone\") {\r\n            value = DateUtils.normalizeHydratedDate(value);\r\n\r\n        } else if (columnMetadata.type === \"date\") {\r\n            value = DateUtils.mixedDateToDateString(value);\r\n\r\n        } else if (columnMetadata.type === \"time\") {\r\n            value = DateUtils.mixedTimeToString(value);\r\n\r\n        } else if (columnMetadata.type === \"simple-array\") {\r\n            value = DateUtils.stringToSimpleArray(value);\r\n\r\n        } else if (columnMetadata.type === \"simple-json\") {\r\n            value = DateUtils.stringToSimpleJson(value);\r\n        }\r\n\r\n        if (columnMetadata.transformer)\r\n            value = columnMetadata.transformer.from(value);\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Replaces parameters in the given sql with special escaping character\r\n     * and an array of parameter names to be passed to a query.\r\n     */\r\n    escapeQueryWithParameters(sql: string, parameters: ObjectLiteral): [string, any[]] {\r\n        if (!parameters || !Object.keys(parameters).length)\r\n            return [sql, []];\r\n\r\n        const builtParameters: any[] = [];\r\n        const keys = Object.keys(parameters).map(parameter => \"(:\" + parameter + \"\\\\b)\").join(\"|\");\r\n        sql = sql.replace(new RegExp(keys, \"g\"), (key: string): string => {\r\n            const value = parameters[key.substr(1)];\r\n            if (value instanceof Array) {\r\n                return value.map((v: any) => {\r\n                    builtParameters.push(v);\r\n                    return \"$\" + builtParameters.length;\r\n                }).join(\", \");\r\n\r\n            } else if (value instanceof Function) {\r\n                return value();\r\n\r\n            } else {\r\n                builtParameters.push(value);\r\n                return \"$\" + builtParameters.length;\r\n            }\r\n        }); // todo: make replace only in value statements, otherwise problems\r\n        return [sql, builtParameters];\r\n    }\r\n\r\n    /**\r\n     * Escapes a column name.\r\n     */\r\n    escape(columnName: string): string {\r\n        return \"\\\"\" + columnName + \"\\\"\";\r\n    }\r\n\r\n    /**\r\n     * Creates a database type from a given column metadata.\r\n     */\r\n    normalizeType(column: { type?: ColumnType, length?: number | string, precision?: number, scale?: number, isArray?: boolean }): string {\r\n        let type = \"\";\r\n        if (column.type === Number) {\r\n            type += \"integer\";\r\n\r\n        } else if (column.type === String) {\r\n            type += \"character varying\";\r\n\r\n        } else if (column.type === Date) {\r\n            type += \"timestamp\";\r\n\r\n        } else if (column.type === Boolean) {\r\n            type += \"boolean\";\r\n\r\n        } else if (column.type === \"simple-array\") {\r\n            type += \"text\";\r\n\r\n        } else if (column.type === \"simple-json\") {\r\n            type += \"text\";\r\n\r\n        } else {\r\n            type += column.type;\r\n        }\r\n\r\n        // normalize shortcuts\r\n        if (type === \"int\" || type === \"int4\") {\r\n            type = \"integer\";\r\n\r\n        } else if (type === \"int2\") {\r\n            type = \"smallint\";\r\n\r\n        } else if (type === \"int8\") {\r\n            type = \"bigint\";\r\n\r\n        } else if (type === \"decimal\") {\r\n            type = \"numeric\";\r\n\r\n        } else if (type === \"float8\") {\r\n            type = \"double precision\";\r\n\r\n        } else if (type === \"float4\") {\r\n            type = \"real\";\r\n\r\n        } else if (type === \"citext\") {\r\n            type = \"citext\";\r\n\r\n        } else if (type === \"char\") {\r\n            type = \"character\";\r\n\r\n        } else if (type === \"varchar\") {\r\n            type = \"character varying\";\r\n\r\n        } else if (type === \"time\") {\r\n            type = \"time without time zone\";\r\n\r\n        } else if (type === \"timetz\") {\r\n            type = \"time with time zone\";\r\n\r\n        } else if (type === \"timestamptz\") {\r\n            type = \"timestamp with time zone\";\r\n\r\n        } else if (type === \"bool\") {\r\n            type = \"boolean\";\r\n\r\n        } else if (type === \"varbit\") {\r\n            type = \"bit varying\";\r\n\r\n        } else if (type === \"timestamp\") {\r\n            type = \"timestamp without time zone\";\r\n        }\r\n\r\n        return type;\r\n    }\r\n\r\n    /**\r\n     * Normalizes \"default\" value of the column.\r\n     */\r\n    normalizeDefault(column: ColumnMetadata): string {\r\n        const arrayCast = column.isArray ? `::${column.type}[]` : \"\";\r\n\r\n        if (typeof column.default === \"number\") {\r\n            return \"\" + column.default;\r\n\r\n        } else if (typeof column.default === \"boolean\") {\r\n            return column.default === true ? \"true\" : \"false\";\r\n\r\n        } else if (typeof column.default === \"function\") {\r\n            return column.default();\r\n\r\n        } else if (typeof column.default === \"string\") {\r\n            return `'${column.default}'${arrayCast}`;\r\n\r\n        } else if (typeof column.default === \"object\") {\r\n            return `'${JSON.stringify(column.default)}'`;\r\n\r\n        } else {\r\n            return column.default;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Normalizes \"isUnique\" value of the column.\r\n     */\r\n    normalizeIsUnique(column: ColumnMetadata): boolean {\r\n        return column.isUnique;\r\n    }\r\n\r\n    /**\r\n     * Calculates column length taking into account the default length values.\r\n     */\r\n    getColumnLength(column: ColumnMetadata): string {\r\n\r\n        if (column.length)\r\n            return column.length;\r\n\r\n        const normalizedType = this.normalizeType(column) as string;\r\n        if (this.dataTypeDefaults && this.dataTypeDefaults[normalizedType] && this.dataTypeDefaults[normalizedType].length)\r\n            return this.dataTypeDefaults[normalizedType].length!.toString();\r\n\r\n        return \"\";\r\n    }\r\n\r\n    /**\r\n     * Normalizes \"default\" value of the column.\r\n     */\r\n    createFullType(column: TableColumn): string {\r\n        let type = column.type;\r\n\r\n        if (column.length) {\r\n            type += \"(\" + column.length + \")\";\r\n        } else if (column.precision && column.scale) {\r\n            type += \"(\" + column.precision + \",\" + column.scale + \")\";\r\n        } else if (column.precision) {\r\n            type +=  \"(\" + column.precision + \")\";\r\n        } else if (column.scale) {\r\n            type +=  \"(\" + column.scale + \")\";\r\n        } else  if (this.dataTypeDefaults && this.dataTypeDefaults[column.type] && this.dataTypeDefaults[column.type].length) {\r\n            type +=  \"(\" + this.dataTypeDefaults[column.type].length!.toString() + \")\";\r\n        }\r\n\r\n        if (column.type === \"time without time zone\") {\r\n            type = \"TIME\" + (column.precision ? \"(\" + column.precision + \")\" : \"\");\r\n\r\n        } else if (column.type === \"time with time zone\") {\r\n            type = \"TIME\" + (column.precision ? \"(\" + column.precision + \")\" : \"\") + \" WITH TIME ZONE\";\r\n\r\n        } else if (column.type === \"timestamp without time zone\") {\r\n            type = \"TIMESTAMP\" + (column.precision ? \"(\" + column.precision + \")\" : \"\");\r\n\r\n        } else if (column.type === \"timestamp with time zone\") {\r\n            type = \"TIMESTAMP\" + (column.precision ? \"(\" + column.precision + \")\" : \"\") + \" WITH TIME ZONE\";\r\n        }\r\n\r\n        if (column.isArray)\r\n            type += \" array\";\r\n\r\n        return type;\r\n    }\r\n\r\n    /**\r\n     * Obtains a new database connection to a master server.\r\n     * Used for replication.\r\n     * If replication is not setup then returns default connection's database connection.\r\n     */\r\n    obtainMasterConnection(): Promise<any> {\r\n        return new Promise((ok, fail) => {\r\n            this.master.connect((err: any, connection: any, release: any) => {\r\n                err ? fail(err) : ok([connection, release]);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Obtains a new database connection to a slave server.\r\n     * Used for replication.\r\n     * If replication is not setup then returns master (default) connection's database connection.\r\n     */\r\n    obtainSlaveConnection(): Promise<any> {\r\n        if (!this.slaves.length)\r\n            return this.obtainMasterConnection();\r\n\r\n        return new Promise((ok, fail) => {\r\n            const random = Math.floor(Math.random() * this.slaves.length);\r\n            this.slaves[random].connect((err: any, connection: any, release: any) => {\r\n                err ? fail(err) : ok([connection, release]);\r\n            });\r\n        });\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Loads postgres query stream package.\r\n     */\r\n    loadStreamDependency() {\r\n        try {\r\n            return PlatformTools.load(\"pg-query-stream\");\r\n\r\n        } catch (e) { // todo: better error for browser env\r\n            throw new Error(`To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.`);\r\n        }\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * If driver dependency is not given explicitly, then try to load it via \"require\".\r\n     */\r\n    protected loadDependencies(): void {\r\n        try {\r\n            this.postgres = PlatformTools.load(\"pg\");\r\n            try {\r\n                const pgNative = PlatformTools.load(\"pg-native\");\r\n                if (pgNative && this.postgres.native) this.postgres = this.postgres.native;\r\n\r\n            } catch (e) { }\r\n\r\n        } catch (e) { // todo: better error for browser env\r\n            throw new DriverPackageNotInstalledError(\"Postgres\", \"pg\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a new connection pool for a given database credentials.\r\n     */\r\n    protected async createPool(options: PostgresConnectionOptions, credentials: PostgresConnectionCredentialsOptions): Promise<any> {\r\n\r\n        credentials = Object.assign(credentials, DriverUtils.buildDriverOptions(credentials)); // todo: do it better way\r\n\r\n        // build connection options for the driver\r\n        const connectionOptions = Object.assign({}, {\r\n            host: credentials.host,\r\n            user: credentials.username,\r\n            password: credentials.password,\r\n            database: credentials.database,\r\n            port: credentials.port,\r\n            ssl: credentials.ssl\r\n        }, options.extra || {});\r\n\r\n        // create a connection pool\r\n        const pool = new this.postgres.Pool(connectionOptions);\r\n        const { logger } = this.connection;\r\n        /*\r\n          Attaching an error handler to pool errors is essential, as, otherwise, errors raised will go unhandled and\r\n          cause the hosting app to crash.\r\n         */\r\n        pool.on(\"error\", (error: any) => logger.log(\"warn\", `Postgres pool raised an error. ${error}`));\r\n\r\n        return new Promise((ok, fail) => {\r\n            pool.connect((err: any, connection: any, release: Function) => {\r\n                if (err) return fail(err);\r\n                release();\r\n                ok(pool);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Closes connection pool.\r\n     */\r\n    protected async closePool(pool: any): Promise<void> {\r\n        await Promise.all(this.connectedQueryRunners.map(queryRunner => queryRunner.release()));\r\n        return new Promise<void>((ok, fail) => {\r\n            pool.end((err: any) => err ? fail(err) : ok());\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Executes given query.\r\n     */\r\n    protected executeQuery(connection: any, query: string) {\r\n        return new Promise((ok, fail) => {\r\n            connection.query(query, (err: any, result: any) => {\r\n                if (err) return fail(err);\r\n                ok(result);\r\n            });\r\n        });\r\n    }\r\n\r\n}\r\n"],"sourceRoot":"../.."}